# 아키텍처 다이어그램

## 시스템 아키텍처 개요

```
┌──────────────────────────────────────────────────────────────────────────────┐
│                            CLIENT (Electron Desktop App)                      │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────────────────┐   │
│  │  Audio Capture  │  │   WebSocket     │  │     React Flow              │   │
│  │  (System Audio) │──│   Client        │──│     Visualization           │   │
│  └─────────────────┘  └────────┬────────┘  └─────────────────────────────┘   │
│                                │                                              │
│  ┌─────────────────────────────┴─────────────────────────────────────────┐   │
│  │  Zustand Store (Graph State, Transcripts, Feedback)                    │   │
│  └───────────────────────────────────────────────────────────────────────┘   │
└──────────────────────────────────────────────────────────────────────────────┘
                                     │
                                     │ WebSocket (wss://)
                                     ▼
┌──────────────────────────────────────────────────────────────────────────────┐
│                         GOOGLE CLOUD PLATFORM                                 │
│                                                                               │
│  ┌─────────────────────────────────────────────────────────────────────────┐ │
│  │                        VPC Network (10.0.0.0/24)                        │ │
│  │                                                                         │ │
│  │  ┌───────────────────────────────────────────────────────────────────┐ │ │
│  │  │                     Cloud Run (API Server)                        │ │ │
│  │  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────────────────┐   │ │ │
│  │  │  │ FastAPI     │  │ WebSocket   │  │ Processing Pipeline     │   │ │ │
│  │  │  │ Server      │──│ Handler     │──│ (STT→NLP→Extraction)    │   │ │ │
│  │  │  └─────────────┘  └─────────────┘  └───────────┬─────────────┘   │ │ │
│  │  │                                                │                  │ │ │
│  │  │                      ┌─────────────────────────┼──────────────┐   │ │ │
│  │  │                      │                         │              │   │ │ │
│  │  │  ┌───────────────────▼───────┐  ┌─────────────▼───────────┐  │   │ │ │
│  │  │  │ Cloud Speech-to-Text v2   │  │     Vertex AI           │  │   │ │ │
│  │  │  │ • Chirp 2 Model           │  │     (Gemini 2.0 Flash)  │  │   │ │ │
│  │  │  │ • Multi-language          │  │     • Entity Extraction │  │   │ │ │
│  │  │  │   (KO, EN, JA, ZH)        │  │     • Relation Mining   │  │   │ │ │
│  │  │  └───────────────────────────┘  └─────────────────────────┘  │   │ │ │
│  │  │                                                              │   │ │ │
│  │  └──────────────────────────────────────────────────────────────┘   │ │ │
│  │                                │                                     │ │
│  │                    VPC Connector                                     │ │
│  │                                │                                     │ │
│  │  ┌─────────────────────────────┴─────────────────────────────────┐  │ │
│  │  │                                                                │  │ │
│  │  │   ┌──────────────────────┐      ┌────────────────────────┐    │  │ │
│  │  │   │   Memorystore        │      │   Cloud Storage        │    │  │ │
│  │  │   │   (Redis 7.0)        │      │   (Bucket)             │    │  │ │
│  │  │   │                      │      │                        │    │  │ │
│  │  │   │  • Session State     │      │  • Audio Files         │    │  │ │
│  │  │   │  • Graph Cache       │      │  • Graph Snapshots     │    │  │ │
│  │  │   │  • Real-time Queues  │      │  • Session Logs        │    │  │ │
│  │  │   └──────────────────────┘      └────────────────────────┘    │  │ │
│  │  │                                                                │  │ │
│  │  │   ┌────────────────────────────────────────────────────────┐  │  │ │
│  │  │   │                     BigQuery                            │  │  │ │
│  │  │   │                                                         │  │  │ │
│  │  │   │  ┌─────────────┐  ┌──────────────┐  ┌───────────────┐  │  │  │ │
│  │  │   │  │ session_    │  │ extraction_  │  │ user_         │  │  │  │ │
│  │  │   │  │ events      │  │ results      │  │ feedback      │  │  │  │ │
│  │  │   │  │             │  │              │  │               │  │  │  │ │
│  │  │   │  │ • Logs      │  │ • Entities   │  │ • Ratings     │  │  │  │ │
│  │  │   │  │ • Metrics   │  │ • Relations  │  │ • Comments    │  │  │  │ │
│  │  │   │  │ • Events    │  │ • Timing     │  │ • Analytics   │  │  │  │ │
│  │  │   │  └─────────────┘  └──────────────┘  └───────────────┘  │  │  │ │
│  │  │   └────────────────────────────────────────────────────────┘  │  │ │
│  │  │                                                                │  │ │
│  │  └────────────────────────────────────────────────────────────────┘  │ │
│  │                                                                       │ │
│  └───────────────────────────────────────────────────────────────────────┘ │
│                                                                             │
│  ┌───────────────────────────────────────────────────────────────────────┐ │
│  │                        Security & Networking                          │ │
│  │  • Private Google Access (googleapis.com)                             │ │
│  │  • VPC Firewall Rules (internal only: 10.0.0.0/8)                    │ │
│  │  • IAM Least Privilege (Service Account per service)                 │ │
│  │  • TLS Encryption (in-transit)                                       │ │
│  └───────────────────────────────────────────────────────────────────────┘ │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

## 데이터 흐름

### 1. 실시간 처리 파이프라인

```
┌─────────────┐     ┌─────────────┐     ┌─────────────┐     ┌─────────────┐
│   Audio     │     │    STT      │     │    NLP      │     │ Extraction  │
│   Capture   │────▶│  (Speech    │────▶│  (Sentence  │────▶│ (Vertex AI  │
│             │     │   v2)       │     │   Split)    │     │  Gemini)    │
└─────────────┘     └─────────────┘     └─────────────┘     └──────┬──────┘
                                                                    │
     ┌──────────────────────────────────────────────────────────────┘
     │
     ▼
┌─────────────┐     ┌─────────────┐     ┌─────────────┐
│   Graph     │     │   Delta     │     │  Client     │
│   State     │────▶│  Broadcast  │────▶│  Update     │
│   Update    │     │  (WebSocket)│     │  (React     │
│             │     │             │     │   Flow)     │
└─────────────┘     └─────────────┘     └─────────────┘
```

### 2. 피드백 루프

```
┌─────────────┐     ┌─────────────┐     ┌─────────────┐
│   User      │     │  BigQuery   │     │  Feedback   │
│   Feedback  │────▶│  Storage    │────▶│  Analysis   │
│   (1-5 ⭐)   │     │             │     │  (Vertex AI)│
└─────────────┘     └─────────────┘     └──────┬──────┘
                                               │
     ┌─────────────────────────────────────────┘
     │
     ▼
┌─────────────┐     ┌─────────────┐
│  Prompt     │     │  Improved   │
│  Context    │────▶│  Extraction │
│  Update     │     │  Quality    │
└─────────────┘     └─────────────┘
```

## 서비스 컴포넌트

### Cloud Run (API Server)

| 구성 요소 | 설명 |
|----------|------|
| FastAPI | REST API 및 WebSocket 엔드포인트 |
| STT Worker | 오디오 → 텍스트 변환 (비동기) |
| NLP Worker | 문장 분리 및 형태소 분석 |
| Extraction Worker | 엔티티/관계 추출 (비동기) |
| Graph Manager | 그래프 상태 관리 및 동기화 |

### GCP 서비스 역할

| 서비스 | 역할 |
|--------|------|
| Cloud Speech-to-Text v2 | 다국어 실시간 음성 인식 |
| Vertex AI (Gemini) | 지식 추출 및 피드백 분석 |
| Memorystore (Redis) | 세션 상태 및 그래프 캐시 |
| Cloud Storage | 오디오/그래프 영구 저장 |
| BigQuery | 분석 데이터 및 피드백 저장 |

## 확장성 고려사항

### 수평 확장

```
                    Load Balancer
                         │
          ┌──────────────┼──────────────┐
          │              │              │
          ▼              ▼              ▼
    ┌──────────┐   ┌──────────┐   ┌──────────┐
    │ Cloud Run│   │ Cloud Run│   │ Cloud Run│
    │ Instance │   │ Instance │   │ Instance │
    │   #1     │   │   #2     │   │   #N     │
    └────┬─────┘   └────┬─────┘   └────┬─────┘
         │              │              │
         └──────────────┼──────────────┘
                        │
                        ▼
              ┌─────────────────┐
              │   Memorystore   │
              │   (Shared State)│
              └─────────────────┘
```

### 성능 특성

| 지표 | 목표값 |
|------|--------|
| WebSocket 지연 시간 | < 100ms |
| STT 처리 시간 | < 500ms/청크 |
| 추출 처리 시간 | < 2s/문장 |
| 최대 동시 세션 | 100+ |
| 그래프 노드 한계 | 1000+ |

## 보안 아키텍처

```
┌──────────────────────────────────────────────────────────────┐
│                     Public Internet                           │
└───────────────────────────┬──────────────────────────────────┘
                            │
                     Cloud Armor (DDoS)
                            │
                    TLS Termination
                            │
              ┌─────────────┴─────────────┐
              │     Cloud Run Service      │
              │   (Service Account Auth)   │
              └─────────────┬─────────────┘
                            │
                    VPC Connector
                            │
              ┌─────────────┴─────────────┐
              │      Private VPC           │
              │                            │
              │  ┌─────────┐ ┌─────────┐  │
              │  │ Redis   │ │ GCP     │  │
              │  │(Private)│ │ APIs    │  │
              │  └─────────┘ └─────────┘  │
              │                            │
              └────────────────────────────┘
```

